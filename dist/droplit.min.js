/*!
 * DroplitJS v0.0.0
 * Copyright 2014 Travis McKinney (braznaavtrav)
 * Licensed under MIT (https://github.com/braznaavtrav/DroplitJS/blob/master/LICENSE)
 */
!function(){"use strict";var a,b,c,d,e;a=[].slice,c=function(){var b,c,d,e,f,g,h;for(e=arguments[0],d=2<=arguments.length?a.call(arguments,1):[],g=0,h=d.length;h>g;g++){c=d[g];for(b in c)f=c[b],e[b]=f}return e},d=function(a,b){var c=new RegExp(b,"g");return a.className.match(c)||(a.className+=" "+b),a},e=function(a,b){var c=new RegExp(b,"g");a.className=a.className.replace(c," ")},b=function(a,b){if("string"==typeof a?this.element=document.querySelector(a):"object"==typeof a&&(this.element=a),!this.element||null===this.element.nodeType)throw new Error("Invalid droplit element.");if(this.element.droplit)throw new Error("Droplit already attached.");this.element.droplit=this,this.options=c({},this.defaultOptions,null!==b?b:{}),this.initialize()},b.prototype.defaultOptions={url:null,method:"post",divClassName:"droplit",hoverClassName:"hover",dropClassName:"dropped",showProgress:!0,acceptedTypes:["image/png","image/jpeg","image/gif"]},b.prototype.initialize=function(){this.convertAcceptedTypes(),this.hideInputElement(),this.createDroplitDiv(),this.setUpEventListeners()},b.prototype.convertAcceptedTypes=function(){for(var a={},b=this.options.acceptedTypes.length-1;b>=0;b--)a[this.options.acceptedTypes[b]]=!0;this.options.acceptedTypes=a},b.prototype.hideInputElement=function(){this.element.style.display="none"},b.prototype.createDroplitDiv=function(){this.droparea=document.createElement("div"),this.droparea.className=this.options.divClassName,this.element.parentNode.insertBefore(this.droparea,this.element)},b.prototype.createProgressElement=function(){this.progressElement=document.createElement("progress"),this.progressElement.min=0,this.progressElement.max=100,this.progressElement.value=0,this.droparea.appendChild(this.progressElement)},b.prototype.setUpEventListeners=function(){var a=this;this.droparea.ondragover=function(){return d(a.droparea,a.options.hoverClassName),!1},this.droparea.ondragleave=function(){return e(a.droparea,a.options.hoverClassName),!1},this.droparea.ondrop=function(b){b.preventDefault(),a.options.showProgress&&a.createProgressElement(),d(a.droparea,a.options.dropClassName),e(a.droparea,a.options.hoverClassName),b.dataTransfer&&a.readFiles(b.dataTransfer.files)}},b.prototype.readFiles=function(a){for(var b=this,c=window.FormData?new FormData:null,d=a.length-1;d>=0;d--)window.FormData&&c.append("file",a.item(d)),b.previewFile(a.item(d));if(window.FormData){var e=new XMLHttpRequest;e.open(b.options.method,b.options.url),e.onload=function(){b.progressElement.value=b.progressElement.innerHTML=100},"upload"in new XMLHttpRequest&&(e.upload.onprogress=function(a){if(a.lengthComputable){var c=a.loaded/a.total*100|0;b.progressElement.value=b.progressElement.innerHTML=c}}),e.send(c)}},b.prototype.previewFile=function(a){var b=this;if("undefined"!=typeof FileReader&&b.options.acceptedTypes[a.type]){var c=new FileReader;c.onload=function(a){var c=new Image;c.src=a.target.result,c.width=250,b.droparea.appendChild(c)},c.readAsDataURL(a)}else b.droparea.innerHTML+="<p>Uploaded "+a.name+" "+(a.size?(a.size/1024|0)+"K":"");b.droparea.removeChild(b.progressElement)},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.droplit=function(a){return this.each(function(){return new b(this,a)})}),"undefined"!=typeof module&&null!==module?module.exports=b:window.Droplit=b}();