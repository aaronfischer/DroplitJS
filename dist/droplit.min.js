/*!
 * DroplitJS v0.0.0
 * Copyright 2014 Travis McKinney (braznaavtrav)
 * Licensed under MIT (https://github.com/braznaavtrav/DroplitJS/blob/master/LICENSE)
 */
!function(){"use strict";var a,b,c,d,e,f;a=[].slice,c=function(){var b,c,d,e,f,g,h;for(e=arguments[0],d=2<=arguments.length?a.call(arguments,1):[],g=0,h=d.length;h>g;g++){c=d[g];for(b in c)f=c[b],e[b]=f}return e},e=function(a,b){var c=new RegExp(b,"g");return a.className.match(c)||(a.className+=" "+b),a},f=function(a,b){var c=new RegExp(b,"g");a.className=a.className.replace(c," ")},d=function(a){a.style.display="none"},b=function(a,b){if("string"==typeof a?this.element=document.querySelector(a):"object"==typeof a&&(this.element=a),!this.element||null===this.element.nodeType)throw new Error("Invalid droplit element.");if(this.element.droplit)throw new Error("Droplit already attached.");this.element.droplit=this,this.options=c({},this.defaultOptions,null!==b?b:{}),this.initialize()},b.prototype.defaultOptions={url:null,method:"POST",param:"myFile",divClassName:"droplit",hoverClassName:"hover",dropClassName:"dropped",showProgress:!0,dropareaText:"Drop files here",buttonText:"Select Files",previewWidth:100,acceptedTypes:["image/png","image/jpeg","image/gif"]},b.prototype.initialize=function(){this.convertAcceptedTypes(),this.convertURL(),new b.Droparea(this.element,this.options)},b.prototype.convertAcceptedTypes=function(){for(var a={},b=this.options.acceptedTypes.length-1;b>=0;b--)a[this.options.acceptedTypes[b]]=!0;this.options.acceptedTypes=a},b.prototype.convertURL=function(){"function"==typeof this.options.url&&(this.options.url=this.options.url(this))},b.Droparea=function(a,c){this.options=c,this.element="DIV"!==a.nodeName?document.createElement("div"):a,this.element.className=c.divClassName,"DIV"!==a.nodeName&&a.parentNode.insertBefore(this.element,a),"INPUT"===a.nodeName?this.inputElement=a:(this.inputElement=document.createElement("input"),a.appendChild(this.inputElement)),d(this.inputElement),this.element.innerText=this.options.dropareaText,new b.Button(this),this.bindUIActions()},b.Droparea.prototype.bindUIActions=function(){var a=this;this.element.ondragover=function(){return e(a.element,a.options.hoverClassName),a.options.onDropAreaDragOver&&a.options.onDropAreaDragOver(),!1},this.element.ondragleave=function(){return f(a.element,a.options.hoverClassName),a.options.onDropAreaDragLeave&&a.options.onDropAreaDragLeave(),!1},this.element.ondrop=function(b){b.preventDefault(),e(a.element,a.options.dropClassName),f(a.element,a.options.hoverClassName),a.options.onDropAreaDrop&&a.options.onDropAreaDrop(),b.dataTransfer&&a.readFiles(b.dataTransfer.files)}},b.Droparea.prototype.readFiles=function(a){for(var c=a.length-1;c>=0;c--)new b.File(a.item(c),this.options,this.element)},b.Button=function(a){this.droparea=a,this.element=document.createElement("button"),this.options=a.options,this.element.innerText=this.options.buttonText,this.droparea.element.appendChild(this.element),this.bindUIActions()},b.Button.prototype.bindUIActions=function(){var a=this;this.element.onclick=function(b){b.preventDefault(),a.droparea.inputElement.click()}},b.File=function(a,b,c){this.file=a,this.options=b,this.droparea=c,this.formData=window.FormData?new FormData:null,this.progressElement=document.createElement("progress"),this.progressElement.min=0,this.progressElement.max=100,this.progressElement.value=0,c.appendChild(this.progressElement),this.renderPreview(),this.submitData()},b.File.prototype.renderPreview=function(){var a=this;if(a.options.acceptedTypes[a.file.type]){var b=new FileReader;b.onload=function(b){var c=new Image;c.src=b.target.result,c.width=a.options.previewWidth,a.droparea.appendChild(c)},b.readAsDataURL(a.file)}else a.droparea.innerHTML+="<p>Uploaded "+a.file.name+" "+(a.file.size?(a.file.size/1024|0)+"K":"")},b.File.prototype.submitData=function(){var a=this,b=new FormData;b.append(a.options.param,a.file);var c=new XMLHttpRequest;c.open(a.options.method,a.options.url),c.onload=function(){a.droparea.removeChild(a.progressElement)},c.upload.onprogress=function(b){var c=b.loaded/b.total*100|0;a.progressElement.value=a.progressElement.innerHTML=c},c.send(b)},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.droplit=function(a){return this.each(function(){return new b(this,a)})}),"undefined"!=typeof module&&null!==module?module.exports=b:window.Droplit=b}();